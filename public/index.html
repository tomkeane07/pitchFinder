<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <title>pitchFinder</title>
        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
        <link href="/styles.css" rel="stylesheet" />        
    </head>
    <body>

        <h1 class="title">PITCH FINDER - a REST API</h1>
        <div id="homepage">
            <h1>Find a football pitch in your area!</h1>
            <div id="pitches"></div>
        </div>


        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
        <script src="https://unpkg.com/react@15/dist/react.js"></script>
        <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>


        <!-- Create React Component -->
        <!-- will be rendered to html above -->

        <script type="text/babel">
            var Pitches = React.createClass({
                getInitialState: function(){
                    return({
                        pitches:[]
                    })
                },

                render: function(){
                    var pitches = this.state.pitches;
                    pitches = pitches.map(function(pitch, index){
                        return(
                                <li key={index}>
                                    <span className="name">{pitch.name}</span>
                                    <span className="dist">{Math.floor(pitch.dist.calculated/1000)} km</span>
                                    {/*-- dis is a geonear property */}

                                </li>

                            );
                    });

                    return(
                        <div id="pitch-container">
                            <form id="search" onSubmit={this.handleSubmit}>
                                <label>Enter your Latitude:</label>
                                <input id="inLat" type="text" ref="lat" placeholder="latitude" required />
                                <label>Enter your Longitude:</label>
                                <input id="inLng" type="text" ref="lng" placeholder="longitude" required />
                                <input type="submit" value="Find Pitches" />
                            </form>
                            <button id="getLocation" onClick={this.getLocation}>get Location</button>
                            <ul>{pitches}</ul>
                       </div>
                    );
                },
                handleSubmit: function(e){
                    e.preventDefault();
                    var lng = this.refs.lng.value;
                    var lat = this.refs.lat.value;
                    fetch('/api/pitches?lng=' + lng + '&lat=' + lat).then(function(data){
                        return data.json();
                    }).then( json => {
                        this.setState({
                            pitches: json
                        });
                        console.log(json);
                    });
                },

                getLocation: function(){
                    navigator.geolocation.getCurrentPosition(success, error, options);
                }
            });


            ReactDOM.render(<Pitches/>, document.getElementById('pitches'));

            var options = {
              enableHighAccuracy: true,
              timeout: 5000,
              maximumAge: 0
            };

            function success(pos) {
              var crd = pos.coords;
              inLat.value=crd.latitude;
              inLng.value=crd.longitude;
            }

            function error(err) {
              console.warn(`ERROR(${err.code}): ${err.message}`);
            }

            


        </script>


    </body>
</html>